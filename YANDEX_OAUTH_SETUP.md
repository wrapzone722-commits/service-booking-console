# ะะฐัััะพะนะบะฐ ะฏะฝะดะตะบั OAuth ะดะปั ServiceBooking

## ะจะฐะณ 1: ะะตะณะธัััะฐัะธั ะฟัะธะปะพะถะตะฝะธั ะฒ ะฏะฝะดะตะบั

1. ะะตัะตะนะดะธัะต ะฝะฐ https://oauth.yandex.ru/
2. ะะฐะถะผะธัะต "ะกะพะทะดะฐัั ะฝะพะฒะพะต ะฟัะธะปะพะถะตะฝะธะต"
3. ะะฐะฟะพะปะฝะธัะต ัะพัะผั:
   - **ะะฐะทะฒะฐะฝะธะต ะฟัะธะปะพะถะตะฝะธั**: ServiceBooking Admin Console
   - **ะะฟะธัะฐะฝะธะต**: ะะพะฝัะพะปั ัะฟัะฐะฒะปะตะฝะธั ะฐะฒัะพะผะพะนะบะพะน
   - **ะะปะฐััะพัะผั**: ะฒัะฑะตัะธัะต "ะะตะฑ-ัะตัะฒะธัั"
   - **ะะพัััะฟะฝัะต ะดะฐะฝะฝัะต**: ะฒัะฑะตัะธัะต:
     - โ ะะฐัะฐ ัะพะถะดะตะฝะธั
     - โ Email
     - โ ะะฒะฐัะฐั
     - โ ะะฐััะพััะตะต ะธะผั
4. ะะฐะถะผะธัะต "ะกะพะทะดะฐัั"

## ะจะฐะณ 2: ะะพะปััะธัะต ััััะฝัะต ะดะฐะฝะฝัะต

ะะพัะปะต ัะพะทะดะฐะฝะธั ะฟัะธะปะพะถะตะฝะธั ะฒั ัะฒะธะดะธัะต:
- **Client ID** (ID ะฟัะธะปะพะถะตะฝะธั)
- **Client Secret** (ะะฐัะพะปั ะฟัะธะปะพะถะตะฝะธั)

ะกะบะพะฟะธััะนัะต ััะธ ะทะฝะฐัะตะฝะธั.

## ะจะฐะณ 3: ะะพะฑะฐะฒััะต Redirect URI

ะ ะบะพะฝัะพะปะธ ะฟัะธะปะพะถะตะฝะธั ะฏะฝะดะตะบัะฐ:

1. ะะตัะตะนะดะธัะต ะฒ ัะฐะทะดะตะป "ะัะฐะฒะฐ ะดะพัััะฟะฐ"
2. ะ ะฟะพะปะต "Redirect URI" ะดะพะฑะฐะฒััะต:
   ```
   https://ะฒะฐั-ะดะพะผะตะฝ.com/auth/yandex/callback
   ```
   
   ะะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ:
   ```
   http://localhost:5173/auth/yandex/callback
   ```

3. ะะฐะถะผะธัะต "ะกะพััะฐะฝะธัั"

## ะจะฐะณ 4: ะฃััะฐะฝะพะฒะธัะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

ะะพะฑะฐะฒััะต ะฒ ัะฐะนะป `.env` ะธะปะธ ัััะฐะฝะพะฒะธัะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั:

```env
YANDEX_CLIENT_ID=your_client_id_here
YANDEX_CLIENT_SECRET=your_client_secret_here
YANDEX_REDIRECT_URI=https://ะฒะฐั-ะดะพะผะตะฝ.com/auth/yandex/callback
```

ะะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ:
```env
YANDEX_CLIENT_ID=your_client_id_here
YANDEX_CLIENT_SECRET=your_client_secret_here
YANDEX_REDIRECT_URI=http://localhost:5173/auth/yandex/callback
```

## ะจะฐะณ 5: ะะตัะตะทะฐะณััะทะธัะต ะฟัะธะปะพะถะตะฝะธะต

```bash
npm run dev
# ะธะปะธ
npm start
```

## ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Login Page (Frontend)          โ
โ  ะะฝะพะฟะบะฐ "ะัะพะด ัะตัะตะท ะฏะฝะดะตะบั"      โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
                 โ
                 โผ
        GET /api/v1/auth/yandex/url
                 โ
                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะฏะฝะดะตะบั OAuth                   โ
โ (https://oauth.yandex.ru/auth)   โ
โ   ะะพะปัะทะพะฒะฐัะตะปั ะปะพะณะธะฝะธััั         โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
                 โ Redirect ั ะบะพะดะพะผ
                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ YandexCallback (/auth/yandex/callback)
โ 1. ะัะฟัะฐะฒะปัะตั ะบะพะด ะฝะฐ backend
โ 2. Backend ะพะฑะผะตะฝะธะฒะฐะตั ะบะพะด ะฝะฐ token
โ 3. Backend ะฟะพะปััะฐะตั ะธะฝัะพัะผะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปั
โ 4. ะกะพะทะดะฐัั/ะพะฑะฝะพะฒะปัะตั ะฐะบะบะฐัะฝั
โ 5. ะะพะทะฒัะฐัะฐะตั JWT ัะพะบะตะฝ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโ
                 โ JSON ั session_token
                 โผ
        localStorage.setItem("session_token")
                 โ
                 โผ
        Redirect to Dashboard (/)
```

## ะขะตััะธัะพะฒะฐะฝะธะต

### ะะพะบะฐะปัะฝะพ
1. ะฃััะฐะฝะพะฒะธัะต ะฟะตัะตะผะตะฝะฝัะต `.env`
2. ะะฐะฟัััะธัะต `npm run dev`
3. ะะตัะตะนะดะธัะต ะฝะฐ http://localhost:5173/login
4. ะะฐะถะผะธัะต "ะัะพะด ัะตัะตะท ะฏะฝะดะตะบั ๐"
5. ะะฒัะพัะธะทัะนัะตัั ะฒ ะฏะฝะดะตะบั-ะฐะบะบะฐัะฝัะต
6. ะะตัะฝััะตัั ะฒ ะฟัะธะปะพะถะตะฝะธะต ะฐะฒัะพัะธะทะพะฒะฐะฝะฝัะผ

### ะะฐ ะฟัะพะดะต
1. ะฃััะฐะฝะพะฒะธัะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะฝะฐ ัะพััะธะฝะณะต
2. ะฃะฑะตะดะธัะตัั, ััะพ Redirect URI ะฒ ะฏะฝะดะตะบั ัะพะฒะฟะฐะดะฐะตั ั ะฒะฐัะธะผ ะดะพะผะตะฝะพะผ
3. ะัะฟะพะปัะทัะนัะต HTTPS ะดะปั ะฑะตะทะพะฟะฐัะฝะพััะธ

## ะัะพะฑะปะตะผั ะธ ัะตัะตะฝะธั

### "Invalid redirect URI"
- ะัะพะฒะตัััะต, ััะพ Redirect URI ะฒ ะฏะฝะดะตะบัะต ัะพัะฝะพ ัะพะฒะฟะฐะดะฐะตั ั ะฒะฐัะธะผ ะดะพะผะตะฝะพะผ
- ะฃะฑะตะดะธัะตัั, ััะพ ะฒั ะธัะฟะพะปัะทัะตัะต HTTPS ะฝะฐ ะฟัะพะดะต

### "Client ID not configured"
- ะัะพะฒะตัััะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
- ะฃะฑะตะดะธัะตัั, ััะพ `.env` ะทะฐะณััะถะตะฝ ะฟัะฐะฒะธะปัะฝะพ

### "Failed to get user info"
- ะัะพะฒะตัััะต, ััะพ Client Secret ะฟัะฐะฒะธะปัะฝัะน
- ะฃะฑะตะดะธัะตัั, ััะพ ะฟัะธะปะพะถะตะฝะธะต ะฐะบัะธะฒะฝะพ ะฒ ะบะพะฝัะพะปะธ ะฏะฝะดะตะบัะฐ

## ะัะทัะฒ ะะบะบะฐัะฝัะพะฒ ัะตัะตะท ะฏะฝะดะตะบั

ะะพะณะดะฐ ะฟะพะปัะทะพะฒะฐัะตะปั ะฐะฒัะพัะธะทัะตััั ัะตัะตะท ะฏะฝะดะตะบั:
1. ะะฝ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐัั ะฐะบะบะฐัะฝั ะฒ ServiceBooking
2. Email ะฑะตััััั ะธะท ะฟัะพัะธะปั ะฏะฝะดะตะบัะฐ (default_email)
3. ะะผั ะฑะตััััั ะธะท ะฟัะพัะธะปั (display_name ะธะปะธ real_name)
4. ะะบะบะฐัะฝั ะฟะพะผะตัะฐะตััั ะบะฐะบ verified (email ัะถะต ะฟะพะดัะฒะตัะถะดัะฝ ะฒ ะฏะฝะดะตะบัะต)
5. ะะปั ััััะพะนััะฒะฐ ะณะตะฝะตัะธััะตััั ัะฝะธะบะฐะปัะฝัะน QR-ะบะพะด

## ะะตะทะพะฟะฐัะฝะพััั

- Client Secret ะฝะธะบะพะณะดะฐ ะฝะต ะฟะตัะตะดะฐัััั ะฝะฐ ััะพะฝัะตะฝะด
- ะัะต ะพะฟะตัะฐัะธะธ ั ะฏะฝะดะตะบั API ะฟัะพะธััะพะดัั ะฝะฐ backend
- ะะพะด ะฐะฒัะพัะธะทะฐัะธะธ ะพะฑะผะตะฝะธะฒะฐะตััั ะพะดะธะฝ ัะฐะท ะธ ัะดะฐะปัะตััั
- JWT ัะพะบะตะฝั ะธัะฟะพะปัะทััััั ะดะปั ะทะฐัะธัั ัะตััะธะน ะฐะดะผะธะฝะฐ
- API ะบะปััะธ ะธัะฟะพะปัะทััััั ะดะปั ะทะฐัะธัั ะทะฐะฟัะพัะพะฒ ะพั iOS

## ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะตััััั

- [ะะพะบัะผะตะฝัะฐัะธั ะฏะฝะดะตะบั OAuth](https://yandex.ru/dev/id/doc/ru/concepts/oauth-overview)
- [ะะพะปััะตะฝะธะต ะธะฝัะพัะผะฐัะธะธ ะพ ะฟะพะปัะทะพะฒะฐัะตะปะต](https://yandex.ru/dev/id/doc/ru/user-account/user-info)
- [ะะฑะฝะพะฒะปะตะฝะธะต access token](https://yandex.ru/dev/id/doc/ru/concepts/oauth-token-refresh)
